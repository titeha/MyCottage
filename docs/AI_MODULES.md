# AI‑модули: принципы, сценарии, интеграция с календарём (v0.5)

## 1) Общие принципы
- LLM — интерфейс, оркестратор и объяснение.
- “Точность” достигается за счёт:
  - данных дневника (что/где/когда),
  - погоды/агроклимата,
  - справочников/техкарт (RAG),
  - CV‑моделей (по мере зрелости).
- Никаких уверенных “диагнозов” по одному фото без уточнений.
- Любые потенциально опасные действия (химия/обработка) — только как **предложение**, с подтверждением и ссылкой на официальную инструкцию.

## 2) AI‑чат помощник
Вход:
- вопрос пользователя;
- контекст: выбранная посадка/зона/участок;
- погода/риски (заморозки/осадки/жара) при наличии интернета;
- почва/анализы (если есть);
- история работ (журнал).

Выход (строгая структура):
1) Короткий ответ (1–3 предложения)
2) План действий (шаги)
3) Что проверить (2–5 пунктов)
4) Предупреждения/риски
5) “Предложения задач” (TaskProposals) с кнопками “добавить в календарь”

## 3) ИИ‑наблюдения → задачи (ключевая продуктовая фича)
Сущность: **Observation** — результат распознавания (вредитель/болезнь/дефицит/идентификация).

Пайплайн:
1) AI создаёт Observation (тип, объект, confidence).
2) Rules Engine сопоставляет Observation с дневником:
   - есть ли релевантные культуры/посадки,
   - какая фаза сезона (по датам/GDD),
   - есть ли погодные ограничения.
3) Генерируются:
   - Alert (сообщение пользователю),
   - TaskProposals (набор действий).
4) Пользователь подтверждает → создаются реальные Task.

Пример: “совка” → есть яблоня → предложение задач “осмотр/механические меры/(опц.) обработка по инструкции”.

## 4) Обрезка (CV + мастер)
MVP:
- мастер: культура/возраст/цель/сезон + 2–3 фото
- ответ: безопасный план + ограничения + confidence
- fallback: санитарная обрезка при низкой уверенности

Продвинуто:
- подсветка зон на фото (оверлеи)
- видео‑обход + грубая 3D‑оценка
- адаптация под виды: яблоня/груша/смородина/крыжовник/малина/виноград/декоративные

## 5) Болезни/вредители (triage)
MVP:
- вход: культура + фото + условия (теплица/ОГ) + краткий “анамнез”
- выход:
  - 3–5 гипотез с вероятностями
  - уточняющие вопросы/проверки
  - безопасный план действий
  - TaskProposals (осмотр, изоляция, коррекция полива и т.п.)

## 6) Идентификация растений (опционально)
- распознавание культуры/сорняка/декоративного по фото
- связывание с карточкой в дневнике
- предложение “добавить как посадку” (если это культура)

## 7) RAG‑база знаний
Источники:
- справочник культур/сортов
- техкарты выращивания
- справочник СЗР/удобрений (только разрешённые)
- почвы/плодородие (протоколы работ)
- FAQ/статьи/форум (позже, с модерацией)

Требование:
- ответы должны ссылаться на конкретные статьи/карточки внутри приложения или на официальный источник, а не “галлюцинировать”.

